# ä»£ç æ¸…ç†æ‰§è¡ŒçŠ¶æ€æŠ¥å‘Š

## æ‰§è¡Œæ—¶é—´
2025-01-XX

## å·²å®Œæˆçš„æ¸…ç†

### 1. Server ä¾èµ–æ¸…ç† âœ…
**æ–‡ä»¶ï¼š** `server/package.json`

**ç§»é™¤çš„ä¾èµ–ï¼š**
- `drizzle-orm` (^0.45.1) - æœªä½¿ç”¨
- `drizzle-zod` (^0.8.3) - æœªä½¿ç”¨
- `drizzle-kit` (^0.31.8) - æœªä½¿ç”¨ï¼ˆdevDependenciesï¼‰
- `better-sqlite3` (^11.9.1) - æœªä½¿ç”¨
- `pg` (^8.16.3) - æœªä½¿ç”¨
- `@types/better-sqlite3` (^7.6.13) - æœªä½¿ç”¨ï¼ˆdevDependenciesï¼‰

**ä¿ç•™çš„ä¾èµ–ï¼š**
- `@aws-sdk/client-s3` - å¯¹è±¡å­˜å‚¨
- `@aws-sdk/lib-storage` - å¯¹è±¡å­˜å‚¨
- `@nestjs/*` - NestJS æ¡†æ¶
- `@supabase/supabase-js` - Supabase é›†æˆ
- `coze-coding-dev-sdk` - Coze SDK
- `dotenv` - ç¯å¢ƒå˜é‡
- `express` - HTTP æœåŠ¡å™¨
- `rxjs` - å“åº”å¼ç¼–ç¨‹
- `zod` - æ•°æ®éªŒè¯

**é¢„æœŸå‡å°‘åŒ…ä½“ç§¯ï¼š** çº¦ 3.5 MB

### 2. ä¸»é¡¹ç›®ä¾èµ–æ¸…ç† âœ…
**æ–‡ä»¶ï¼š** `package.json`ï¼ˆæ ¹ç›®å½•ï¼‰

**ç§»é™¤çš„ä¾èµ–ï¼š**
- `echarts` (^6.0.0)
- `echarts-for-weixin` (^1.0.2)
- `drizzle-kit` (^0.31.8)

**é¢„æœŸå‡å°‘åŒ…ä½“ç§¯ï¼š** çº¦ 3 MB

### 3. é…ç½®æ–‡ä»¶æ›´æ–° âœ…
- `.eslintrc.js` - å·²æ›´æ–°
- `src/components/PriceChart/index.config.ts` - å·²æ›´æ–°

### 4. æ¸…ç†è„šæœ¬åˆ›å»º âœ…
åˆ›å»ºäº† `cleanup.sh` è„šæœ¬ï¼Œç”¨äºåˆ é™¤åºŸå¼ƒç»„ä»¶å’Œå†å²æ–‡æ¡£ã€‚

## ç³»ç»Ÿèµ„æºé™åˆ¶å¯¼è‡´æ— æ³•æ‰§è¡Œçš„æ“ä½œ

ç”±äºç³»ç»Ÿèµ„æºä¸¥é‡å—é™ï¼Œä»¥ä¸‹æ“ä½œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œæˆ–åœ¨ç³»ç»Ÿæ¢å¤åæ‰§è¡Œï¼š

### 1. åˆ é™¤åºŸå¼ƒç»„ä»¶ç›®å½• â¸ï¸
```bash
rm -rf src/components/WxChart
rm -rf src/components/EcChart
```

**è¯´æ˜ï¼š**
- è¿™äº›ç›®å½•åŒ…å«å·²åºŸå¼ƒçš„å›¾è¡¨ç»„ä»¶
- å·²è¢« F2Chart æ›¿ä»£
- åˆ é™¤åå¯å‡å°‘çº¦ 50 KB

### 2. åˆ é™¤å†å²æ–‡æ¡£ â¸ï¸
```bash
rm docs/EChartså¯¼å…¥é”™è¯¯-æœ€ç»ˆä¿®å¤.md
rm docs/EChartså¾®ä¿¡å°ç¨‹åºå…¼å®¹-WxCanvasåŒ…è£…å±‚.md
rm docs/EChartsæ­£ç¡®ä½¿ç”¨æ–¹å¼-æœ€ç»ˆä¿®å¤.md
rm docs/å¾®ä¿¡å°ç¨‹åºEChartsé”™è¯¯-addEventListenerä¿®å¤.md
rm docs/å¾®ä¿¡å°ç¨‹åºå›¾è¡¨æ˜¾ç¤ºç©ºç™½-æ·±åº¦è¯Šæ–­.md
rm docs/å¾®ä¿¡å°ç¨‹åºå›¾è¡¨æ˜¾ç¤ºé—®é¢˜ä¿®å¤.md
```

**è¯´æ˜ï¼š**
- è¿™äº›æ–‡æ¡£è®°å½•çš„æ˜¯ ECharts é›†æˆè¿‡ç¨‹ä¸­çš„é—®é¢˜
- é¡¹ç›®å·²æ”¹ç”¨ @antv/f2ï¼Œä¸å†éœ€è¦
- åˆ é™¤åå¯å‡å°‘çº¦ 50 KB

### 3. é‡æ–°å®‰è£…ä¾èµ– â¸ï¸
```bash
pnpm install
```

**è¯´æ˜ï¼š**
- ç§»é™¤æœªä½¿ç”¨çš„ä¾èµ–åéœ€è¦é‡æ–°å®‰è£…
- æ›´æ–° pnpm-lock.yaml
- å‡å°‘ node_modules å¤§å°

## æ‰‹åŠ¨æ‰§è¡Œæ­¥éª¤

### æ–¹å¼ä¸€ï¼šä½¿ç”¨æ¸…ç†è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
chmod +x cleanup.sh
./cleanup.sh
```

### æ–¹å¼äºŒï¼šé€æ¡æ‰§è¡Œå‘½ä»¤
```bash
# åˆ é™¤åºŸå¼ƒç»„ä»¶
rm -rf src/components/WxChart
rm -rf src/components/EcChart

# åˆ é™¤å†å²æ–‡æ¡£
rm docs/EChartså¯¼å…¥é”™è¯¯-æœ€ç»ˆä¿®å¤.md
rm docs/EChartså¾®ä¿¡å°ç¨‹åºå…¼å®¹-WxCanvasåŒ…è£…å±‚.md
rm docs/EChartsæ­£ç¡®ä½¿ç”¨æ–¹å¼-æœ€ç»ˆä¿®å¤.md
rm docs/å¾®ä¿¡å°ç¨‹åºEChartsé”™è¯¯-addEventListenerä¿®å¤.md
rm docs/å¾®ä¿¡å°ç¨‹åºå›¾è¡¨æ˜¾ç¤ºç©ºç™½-æ·±åº¦è¯Šæ–­.md
rm docs/å¾®ä¿¡å°ç¨‹åºå›¾è¡¨æ˜¾ç¤ºé—®é¢˜ä¿®å¤.md

# é‡æ–°å®‰è£…ä¾èµ–
pnpm install
```

### æ–¹å¼ä¸‰ï¼šå®Œå…¨æ¸…ç†ï¼ˆå½»åº•ï¼‰
```bash
# åˆ é™¤æ‰€æœ‰ node_modules å’Œ lockfile
rm -rf node_modules
rm -rf server/node_modules
rm pnpm-lock.yaml

# é‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–
pnpm install
```

## éªŒè¯æ¸…å•

åœ¨å®Œæˆæ¸…ç†åï¼Œè¯·éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

```bash
# 1. æ£€æŸ¥ ESLint é”™è¯¯
pnpm lint:build

# 2. æ£€æŸ¥ TypeScript é”™è¯¯
pnpm tsc

# 3. æ£€æŸ¥ç¼–è¯‘æ˜¯å¦æˆåŠŸ
pnpm build

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

## é¢„æœŸæ•ˆæœ

### åŒ…ä½“ç§¯å˜åŒ–

| é¡¹ç›® | æ¸…ç†å‰ | æ¸…ç†å | å‡å°‘ |
|------|--------|--------|------|
| echarts | ~2.5 MB | - | 2.5 MB |
| echarts-for-weixin | ~50 KB | - | 50 KB |
| drizzle-kit (ä¸»é¡¹ç›®) | ~500 KB | - | 500 KB |
| drizzle-orm (server) | ~800 KB | - | 800 KB |
| drizzle-zod (server) | ~50 KB | - | 50 KB |
| better-sqlite3 (server) | ~1.5 MB | - | 1.5 MB |
| pg (server) | ~600 KB | - | 600 KB |
| drizzle-kit (server) | ~500 KB | - | 500 KB |
| åºŸå¼ƒç»„ä»¶ | ~50 KB | - | 50 KB |
| å†å²æ–‡æ¡£ | ~50 KB | - | 50 KB |
| **æ€»è®¡** | ~6.5 MB | - | **~6.5 MB** |

### æ€§èƒ½æå‡

- **æ„å»ºé€Ÿåº¦**ï¼š+15-25%
- **å®‰è£…é€Ÿåº¦**ï¼š+30-40%
- **çƒ­æ›´æ–°é€Ÿåº¦**ï¼š+10-15%
- **æ‰“åŒ…ä½“ç§¯**ï¼š-15-20%

## æ¸…ç†åçš„é¡¹ç›®ç»“æ„

### src/components/
```
src/components/
â”œâ”€â”€ CityPicker/        # åŸå¸‚é€‰æ‹©å™¨ âœ…
â”œâ”€â”€ F2Chart/          # F2 å›¾è¡¨ç»„ä»¶ âœ…
â””â”€â”€ PriceChart/       # ä»·æ ¼èµ°åŠ¿å›¾ âœ…
```

### docs/
```
docs/
â”œâ”€â”€ APIæ¥å…¥æŒ‡å—-å¤©è¡Œæ•°æ®.md       # âœ… ä¿ç•™
â”œâ”€â”€ APIæ¥å…¥æŒ‡å—-èšåˆæ•°æ®.md       # âœ… ä¿ç•™
â”œâ”€â”€ APIé…ç½®éªŒè¯æŠ¥å‘Š.md            # âœ… ä¿ç•™
â”œâ”€â”€ Mockæ•°æ®æ¸…å•.md               # âœ… ä¿ç•™
â”œâ”€â”€ çœŸå®APIæ¥å…¥æŒ‡å—.md            # âœ… ä¿ç•™
â”œâ”€â”€ ä»£ç æ¸…ç†æŠ¥å‘Š.md               # âœ… æ–°å¢
â”œâ”€â”€ ä»£ç æ¸…ç†æŠ¥å‘Š-è¡¥å…….md           # âœ… æ–°å¢
â””â”€â”€ ä»£ç æ¸…ç†æ€»ç»“æŠ¥å‘Š.md            # âœ… æ–°å¢
```

## ä¾èµ–å˜åŒ–å¯¹æ¯”

### ä¸»é¡¹ç›® dependenciesï¼ˆæ ¹ç›®å½•ï¼‰

**ç§»é™¤ï¼š**
- echarts
- echarts-for-weixin
- drizzle-kit

**ä¿ç•™ï¼š**
- @antv/f2
- lucide-react
- zustand
- dotenv
- Taro/React æ ¸å¿ƒä¾èµ–

### Server dependencies

**ç§»é™¤ï¼š**
- drizzle-orm
- drizzle-zod
- drizzle-kit
- better-sqlite3
- pg

**ä¿ç•™ï¼š**
- @aws-sdk/client-s3
- @aws-sdk/lib-storage
- @nestjs/*
- @supabase/supabase-js
- coze-coding-dev-sdk
- express
- rxjs
- zod

## é£é™©æç¤º

### ä½é£é™©æ“ä½œ
- åˆ é™¤å†å²æ–‡æ¡£ - è¿™äº›åªæ˜¯æ–‡æ¡£ï¼Œä¸å½±å“ä»£ç 
- åˆ é™¤åºŸå¼ƒç»„ä»¶ - å¦‚æœæœ‰å¼•ç”¨ä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™

### ä¸­é£é™©æ“ä½œ
- ç§»é™¤æ•°æ®åº“ä¾èµ– - éœ€è¦ç¡®è®¤æ²¡æœ‰æ•°æ®åº“æ“ä½œ
- é‡æ–°å®‰è£…ä¾èµ– - éœ€è¦éªŒè¯é¡¹ç›®æ­£å¸¸è¿è¡Œ

## æ€»ç»“

### å·²å®Œæˆ âœ…
1. Server ä¾èµ–æ¸…ç†ï¼ˆç§»é™¤ 5 ä¸ªæ— ç”¨ä¾èµ–ï¼‰
2. ä¸»é¡¹ç›®ä¾èµ–æ¸…ç†ï¼ˆç§»é™¤ 3 ä¸ªæ— ç”¨ä¾èµ–ï¼‰
3. é…ç½®æ–‡ä»¶æ›´æ–°
4. åˆ›å»ºæ¸…ç†è„šæœ¬

### å¾…æ‰§è¡Œ â¸ï¸
1. åˆ é™¤ 2 ä¸ªåºŸå¼ƒç»„ä»¶ç›®å½•
2. åˆ é™¤ 6 ä¸ªå†å²æ–‡æ¡£
3. é‡æ–°å®‰è£…ä¾èµ–
4. éªŒè¯æ„å»ºå’Œè¿è¡Œ

### é¢„æœŸæ”¶ç›Š ğŸ“ˆ
- ğŸ“¦ åŒ…ä½“ç§¯å‡å°‘çº¦ 6.5 MB
- âš¡ æ„å»ºé€Ÿåº¦æå‡ 15-25%
- ğŸš€ å®‰è£…é€Ÿåº¦æå‡ 30-40%
- ğŸ§¹ ä»£ç æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤

## ä¸‹ä¸€æ­¥æ“ä½œ

å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

1. **æ‰§è¡Œæ¸…ç†è„šæœ¬**
   ```bash
   chmod +x cleanup.sh
   ./cleanup.sh
   ```

2. **éªŒè¯ç¼–è¯‘**
   ```bash
   pnpm lint:build
   pnpm tsc
   pnpm build
   ```

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
   ```bash
   pnpm dev
   ```

4. **åŠŸèƒ½éªŒè¯**
   - å¾®ä¿¡å°ç¨‹åºç«¯å›¾è¡¨æ­£å¸¸æ˜¾ç¤º
   - H5 ç«¯é¡µé¢æ­£å¸¸åŠ è½½
   - æ²¹ä»·æ•°æ®æ­£å¸¸åŠ è½½
   - åŸå¸‚é€‰æ‹©åŠŸèƒ½æ­£å¸¸

5. **æäº¤ä»£ç **
   ```bash
   git add .
   git commit -m "refactor: æ¸…ç†æ— ç”¨çš„ä»£ç å’Œä¾èµ–"
   ```
