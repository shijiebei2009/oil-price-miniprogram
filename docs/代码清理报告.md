# 代码清理报告

## 清理时间
2025-01-XX

## 清理内容

### 1. 移除无用的依赖包

从 `package.json` 中移除以下依赖：

#### dependencies
- `echarts` (^6.0.0) - 已废弃，项目改用 @antv/f2
- `echarts-for-weixin` (^1.0.2) - 已废弃，项目改用 @antv/f2
- `drizzle-kit` (^0.31.8) - 未使用

**保留的依赖：**
- `@antv/f2` (^5.14.0) - 当前使用的图表库
- `dotenv` (^17.2.3) - 环境变量加载，在 config/index.ts 中使用

### 2. 更新配置文件

#### .eslintrc.js
移除了对已废弃组件的 ESLint 规则覆盖：
- 移除 `src/components/ec-canvas/index.js` 引用
- 移除 `src/components/WxChart/wx-canvas.js` 引用

#### src/components/PriceChart/index.config.ts
更新为空配置，移除了对 WxChart 的引用：
```typescript
export default {}
```

### 3. 需要手动删除的组件目录（建议）

以下组件目录可以手动删除（保留在仓库中但不再使用）：

#### src/components/WxChart/
- 原因：已废弃，被 F2Chart 替代
- 文件列表：
  - `src/components/WxChart/index.tsx`
  - `src/components/WxChart/index.css`
  - `src/components/WxChart/index.config.ts`
  - `src/components/WxChart/wx-canvas.js`
- 替代方案：使用 `src/components/F2Chart/`

#### src/components/EcChart/
- 原因：未被使用
- 文件列表：
  - `src/components/EcChart/index.tsx`
  - `src/components/EcChart/index.css`
  - `src/components/EcChart/index.config.ts`
- 状态：历史遗留组件，未在任何页面中使用

### 4. 保留的有用组件

#### src/components/F2Chart/
- 状态：正在使用
- 用途：微信小程序端图表渲染
- 依赖：@antv/f2

#### src/components/PriceChart/
- 状态：正在使用
- 用途：价格走势图组件
- 实现方式：H5 端显示提示，小程序端使用 F2Chart

#### src/components/CityPicker/
- 状态：正在使用
- 用途：城市选择器组件

## 清理效果

### 包体积减少
移除以下依赖包后，预计减少包体积：
- `echarts` ~ 2.5 MB
- `echarts-for-weixin` ~ 50 KB
- `drizzle-kit` ~ 500 KB
- **总计减少约 3 MB**

### 构建速度提升
- 减少不必要的依赖分析时间
- 减少打包体积
- 加快热更新速度

### 代码可维护性提升
- 移除废弃代码，降低维护成本
- 统一图表方案（只使用 @antv/f2）
- 减少 ESLint 配置复杂度

## 清理步骤总结

1. ✅ 更新 `package.json`，移除无用依赖
2. ✅ 更新 `.eslintrc.js`，移除废弃组件的规则覆盖
3. ✅ 更新 `src/components/PriceChart/index.config.ts`
4. ⚠️ 建议手动删除 `src/components/WxChart/` 目录
5. ⚠️ 建议手动删除 `src/components/EcChart/` 目录

## 后续工作

### 需要执行的命令
```bash
# 重新安装依赖（移除未使用的包）
pnpm install

# 清理 pnpm lockfile
pnpm install --frozen-lockfile

# 验证构建
pnpm build
```

### 验证清单
- [ ] 应用正常启动
- [ ] 微信小程序端图表正常显示
- [ ] H5 端页面正常加载
- [ ] 无 ESLint 错误
- [ ] 无 TypeScript 错误
- [ ] 无运行时错误

## 技术说明

### 为什么移除 echarts 和 echarts-for-weixin？
- 微信小程序端使用 ECharts 存在兼容性问题
- echarts-for-weixin 在 Taro 框架中难以集成
- @antv/f2 专为移动端和小程序设计，兼容性更好
- @antv/f2 包体积更小，性能更好

### 为什么移除 drizzle-kit？
- 项目未使用 Drizzle ORM
- drizzle-kit 是数据库工具，仅在需要时才应该安装
- 无需为未使用的工具增加依赖

### 为什么建议手动删除 WxChart 和 EcChart？
- 这些组件是历史遗留代码
- 保留在仓库中会导致混淆
- 删除后需要验证是否有其他地方引用
- 建议先在测试分支删除，确认无问题后再合并到主分支
