# 紧急修复指南 - Resource temporarily unavailable

## 错误信息
```
execute command error: [Errno 11] Resource temporarily unavailable
```

## 问题分析

### 错误含义
`Errno 11` 表示系统资源暂时不可用，通常由以下原因导致：

1. **内存耗尽** - 系统内存不足
2. **进程数限制** - 达到最大进程数
3. **文件描述符耗尽** - 打开文件过多
4. **CPU 过载** - CPU 使用率 100%
5. **系统资源锁死** - 某个进程占用过多资源

### 当前状态
- ✅ 代码正常（所有文件已创建）
- ✅ 修复脚本已准备（`fix-startup.sh`）
- ❌ 无法执行任何命令
- ❌ 控制台无法打开

## 🚨 立即解决方案

### 方案 1：联系平台技术支持（最有效）

**如果这是付费项目，立即联系：**

**邮件/工单内容模板：**
```
主题：付费项目紧急 - 工作空间资源耗尽无法执行命令

项目信息：
- 项目名称：coze-mini-program
- 错误信息：execute command error: [Errno 11] Resource temporarily unavailable
- 用户状态：付费用户
- 影响：无法启动应用，无法执行任何命令

问题描述：
工作空间资源完全耗尽，无法执行任何命令（包括最基本的 pwd 命令）。
所有操作都返回 "Resource temporarily unavailable"。

要求：
1. 立即重启工作空间
2. 清理系统资源
3. 确保应用可以正常启动

紧急程度：最高（项目无法使用）
```

### 方案 2：等待系统自动恢复

**可能的恢复时间：**
- 5-15 分钟（如果平台自动清理）
- 30-60 分钟（如果需要手动干预）
- 2-4 小时（如果需要工单处理）

**等待期间可以做：**
1. 每隔 5 分钟刷新控制台
2. 尝试执行简单的命令（如 `pwd`）
3. 一旦能执行命令，立即运行修复脚本

### 方案 3：查看平台是否有重启功能

**检查平台界面：**
- 工作空间设置
- 实例管理
- 重启按钮
- 清理缓存按钮

## 📋 系统恢复后的操作步骤

### 步骤 1：验证可以执行命令
```bash
# 测试最基本的命令
pwd
```

如果能执行，说明系统已恢复。

### 步骤 2：执行一键修复
```bash
cd /workspace/projects
chmod +x fix-startup.sh
./fix-startup.sh
```

### 步骤 3：验证应用启动
```bash
# 检查端口
curl -I http://localhost:5000
curl -I http://localhost:3000

# 访问页面
# 浏览器打开 http://localhost:5000
```

## 🔍 诊断信息（提供给技术支持）

如果需要联系技术支持，请提供以下信息：

### 基本诊断
```bash
# 系统资源
free -h
df -h
uptime

# 进程信息
ps aux | wc -l
ps aux | sort -rk 3 | head -10

# 错误日志
tail -50 /tmp/coze-logs/dev.log
tail -50 /app/work/logs/bypass/dev.log
```

### 项目信息
- 项目路径：`/workspace/projects`
- 启动命令：`pnpm dev`
- 端口：5000 (前端), 3000 (后端)
- 依赖管理：pnpm

## 📁 已准备的修复文件

所有文件都已创建，系统恢复后即可使用：

| 文件 | 用途 | 使用方式 |
|------|------|----------|
| `fix-startup.sh` | 一键修复 | `./fix-startup.sh` |
| `cleanup.sh` | 代码清理 | `./cleanup.sh` |
| `docs/应用启动问题-紧急修复指南.md` | 详细指南 | 查看 |
| `docs/当前状态说明.md` | 状态说明 | 查看 |
| `docs/代码清理执行状态报告.md` | 清理报告 | 查看 |

## ⚠️ 重要提示

### 不要做的事情
- ❌ 不要重复点击"启动"按钮（会消耗更多资源）
- ❌ 不要同时打开多个终端
- ❌ 不要尝试复杂的命令
- ❌ 不要重新创建项目（会丢失所有代码）

### 可以做的事情
- ✅ 刷新页面
- ✅ 等待几分钟后重试
- ✅ 联系技术支持
- ✅ 查看平台是否有重启选项

## 🎯 预期结果

修复成功后，您会看到：

```
========================================
应用启动修复脚本
========================================

[1/5] 停止所有正在运行的进程...
✓ 进程已停止

[2/5] 清理缓存和依赖...
✓ 缓存已清理

[3/5] 创建 .npmrc 配置...
✓ .npmrc 已创建

[4/5] 重新安装依赖...
✓ 依赖已安装

[5/5] 启动应用...
✓ 应用启动成功！

========================================
访问地址：
  H5 端: http://localhost:5000
  后端: http://localhost:3000
========================================
```

## 📞 技术支持联系

如果问题持续存在，请收集以下信息并提供给技术支持：

1. **错误截图**
   - 控制台错误信息
   - 浏览器错误提示

2. **错误日志**
   ```bash
   tail -100 /tmp/coze-logs/dev.log
   tail -100 /app/work/logs/bypass/dev.log
   ```

3. **系统状态**
   ```bash
   free -h
   df -h
   ps aux | head -20
   ```

4. **项目信息**
   - 项目名称：coze-mini-program
   - 包管理器：pnpm 9.0.0
   - 框架：Taro 4.1.9 + NestJS 10.4.15

## 🔄 后续预防措施

修复成功后，建议：

1. **定期清理缓存**
   ```bash
   pnpm store prune
   ```

2. **监控资源使用**
   ```bash
   watch -n 5 'free -h'
   ```

3. **优化依赖**
   - 移除未使用的包
   - 使用更轻量的替代品

4. **配置限制**
   - 在 `.npmrc` 中设置资源限制
   - 使用 `--max-workers` 限制并发

---

**最后更新：** 2025-01-XX
**状态：** 🔴 等待系统恢复
**优先级：** 最高
**预计恢复：** 取决于平台响应
