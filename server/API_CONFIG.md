# 油价数据配置说明

## 获取真实油价数据

为了获取真实的全国油价数据，需要配置第三方API密钥。当前支持两个API：

### 1. 天聚数行 API（推荐）

**优势：**
- 免费额度：100次/天
- 数据更新及时
- 支持全国各省市数据

**注册步骤：**
1. 访问 https://www.tianapi.com/
2. 注册账号并登录
3. 进入控制台 → API密钥管理
4. 复制您的API密钥

**配置方式：**
```bash
# 在 server 目录下创建 .env 文件
cd server
cp .env.example .env

# 编辑 .env 文件，填入您的API密钥
TIANAPI_KEY=your_actual_api_key_here
```

### 2. 聚合数据 API（备选方案）

**优势：**
- 免费额度：100次/天
- 数据稳定可靠

**注册步骤：**
1. 访问 https://www.juhe.cn/
2. 注册账号并登录
3. 进入控制台 → 个人中心 → 我的API
4. 申请"全国汽油价格查询"API
5. 获取API密钥

**配置方式：**
```bash
# 编辑 .env 文件，填入您的API密钥
JUHE_API_KEY=your_actual_api_key_here
```

## API优先级

系统按以下优先级尝试获取数据：

1. **TIANAPI_KEY**（天聚数行）→ 首选
2. **JUHE_API_KEY**（聚合数据）→ 备选
3. **模拟数据** → 最后的兜底方案

## 模拟数据说明

如果没有配置任何API密钥，系统将使用模拟数据：

- **数据来源**：基于历史调价趋势生成
- **准确性**：仅供参考，不作为实际油价依据
- **更新频率**：每次启动服务器时刷新
- **数据范围**：全国34个省级行政区

## 重启服务

配置API密钥后，需要重启服务：

```bash
# 开发环境
cd /workspace/projects
coze dev

# 或者单独重启后端
cd server
pnpm start:dev
```

## 测试API配置

配置完成后，可以通过以下命令测试：

```bash
curl http://localhost:3000/api/oil-price/province/current?province=北京市
```

如果返回真实数据，说明配置成功！

## 常见问题

### Q: 为什么油价数据不准确？

A: 请检查是否正确配置了API密钥。如果没有配置，系统使用的是模拟数据。

### Q: API调用次数不够用怎么办？

A: 可以同时配置两个API密钥，系统会自动切换。

### Q: 如何查看API调用日志？

A: 查看后端控制台日志，会显示API调用情况和数据来源。

### Q: 数据多久更新一次？

A: 真实API数据：24小时缓存
     模拟数据：每次启动时刷新
